<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil</title>
    <link href="https://fonts.googleapis.com/css2?family=Karantina:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/style_perfil.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/Favicon.ico" type="image/x-icon">
    <script type="module" src="script/script.js"></script>
    <script>
        // Funções dos modais definidas globalmente
        function openEmailModal() {
            document.getElementById('emailModal').style.display = 'flex';
        }

        function closeEmailModal() {
            document.getElementById('emailModal').style.display = 'none';
            document.getElementById('newEmail').value = '';
            document.getElementById('currentPasswordEmail').value = '';
        }

        function openPasswordModal() {
            document.getElementById('passwordModal').style.display = 'flex';
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
    </script>
    <style>
        /* Estilos de alto contraste */
        .high-contrast {
            background-color: #000;
            color: #fff;
        }

        .high-contrast a {
            color: #ff0;
        }

        .high-contrast .navbar {
            background-color: #333;
        }

        .high-contrast .footer {
            background-color: #333;
        }

        .high-contrast .footer-content,
        .high-contrast .footer-section,
        .high-contrast .footer-bottom {
            color: #fff;
        }

        .high-contrast .social-icons a {
            color: #ff0;
        }

        .high-contrast .max-w-4xl {
            background-color: #333;
            color: #fff;
        }

        .high-contrast .bg-white {
            background-color: #333 !important;
        }

        .high-contrast .text-gray-700 {
            color: #fff !important;
        }

        .high-contrast .bg-gray-300 {
            background-color: #666 !important;
        }

        .high-contrast .text-gray-600 {
            color: #fff !important;
        }

        .high-contrast .bg-blue-500 {
            background-color: #ff0 !important;
            color: #000 !important;
        }

        .high-contrast .bg-red-500 {
            background-color: #ff0 !important;
            color: #000 !important;
        }

        .high-contrast .bg-green-500 {
            background-color: #ff0 !important;
            color: #000 !important;
        }

        .high-contrast .hover\:bg-blue-600:hover {
            background-color: #ff0 !important;
        }

        .high-contrast .hover\:bg-red-600:hover {
            background-color: #ff0 !important;
        }

        .high-contrast .hover\:bg-green-600:hover {
            background-color: #ff0 !important;
        }

        .high-contrast .bg-opacity-50 {
            background-color: rgba(0, 0, 0, 0.5) !important;
        }

        .high-contrast .bg-black {
            background-color: #000 !important;
        }

        .high-contrast .bg-gray-100 {
            background-color: #333 !important;
        }

        .high-contrast .bg-gray-400 {
            background-color: #666 !important;
        }

        .high-contrast .bg-gray-500 {
            background-color: #999 !important;
        }

        .high-contrast .text-blue-700 {
            color: #ff0 !important;
        }

        .high-contrast .text-red-700 {
            color: #ff0 !important;
        }

        .high-contrast .text-green-700 {
            color: #ff0 !important;
        }

        .high-contrast .border-blue-500 {
            border-color: #ff0 !important;
        }

        .high-contrast .border-red-500 {
            border-color: #ff0 !important;
        }

        .high-contrast .border-green-500 {
            border-color: #ff0 !important;
        }

        .high-contrast .focus\:border-blue-500:focus {
            border-color: #ff0 !important;
        }

        .high-contrast .focus\:border-red-500:focus {
            border-color: #ff0 !important;
        }

        .high-contrast .focus\:border-green-500:focus {
            border-color: #ff0 !important;
        }
    </style>
</head>

<body class="bg-gray-100" style="background-color: #E3F4FA;">
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
          <div class="vw-plugin-top-wrapper"></div>
        </div>
      </div>
      <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
      <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
      </script>
    
    <!-- Modal Email -->
    <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Alterar Email</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">Novo Email</label>
                    <input type="email" id="newEmail"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Sua Senha</label>
                    <input type="password" id="currentPasswordEmail"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                <div class="flex justify-end space-x-4">
                    <button onclick="closeEmailModal()"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        Cancelar
                    </button>
                    <button id="saveEmailButton" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Senha -->
    <div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Alterar Senha</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">Senha Atual</label>
                    <input type="password" id="currentPassword"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Nova Senha</label>
                    <input type="password" id="newPassword"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Confirmar Nova Senha</label>
                    <input type="password" id="confirmPassword"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>
                <div class="flex justify-end space-x-4">
                    <button onclick="closePasswordModal()"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        Cancelar
                    </button>
                    <button id="savePasswordButton"
                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <header>
        <nav class="navbar" style="height: 80px;">
            <div class="logo">
                <a href=""><img src="img/Logo.png" alt="Logo"></a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html" class="">Início</a></li>
                <li><a href="jogos.html">Jogos</a></li>
                <li><a href="progresso.html">Progresso</a></li>
            </ul>
            <ul class="nav-icons">
                <li class="icon"><a href="#" id="high-contrast"><svg xmlns="http://www.w3.org/2000/svg" width="20"
                            height="20" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16" />
                        </svg></a></li>
                <li class="icon"><a href="#" id="decrease-font">A-</a></li>
                <li class="icon acessib"><a href="#" id="increase-font">A+</a></li>
                <li class="icon"><a href="perfil.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                            <path fill-rule="evenodd"
                                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                        </svg></a></li>
            </ul>
        </nav>
    </header>
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="text-center">
                <div class="relative inline-block">
                    <img id="profileImage"
                        src="https://images.vexels.com/content/150881/preview/baby-rubber-duck-circle-icon-53725b.png"
                        alt="Foto de perfil" class="w-32 h-32 rounded-full border-4 border-blue-500">

                </div>
                <h1 id="displayName" class="text-2xl font-bold mt-4 mb-2">Carregando...</h1>
                <p id="userEmail" class="text-gray-600">Carregando...</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <!-- Informações Pessoais -->
            <div class="space-y-4 max-w-md mx-auto">
                <h2 class="text-xl font-semibold mb-4">Informações Pessoais</h2>

                <div>
                    <label class="block text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="fullName"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <!-- Botões de Email e Senha -->
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button onclick="openEmailModal()"
                        class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                        <i class="fas fa-envelope mr-2"></i>
                        Alterar Email
                    </button>
                    <button onclick="openPasswordModal()"
                        class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                        <i class="fas fa-lock mr-2"></i>
                        Alterar Senha
                    </button>
                </div>
            </div>

            <!-- Botões -->
            <div class="mt-6 flex justify-end space-x-4 max-w-md mx-auto">
                <button id="saveButton"
                    class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                    Salvar Alterações
                </button>
            </div>
            <br>
            <br>
            <br>
            <br>
            <a href="home.html#suporte"> <button
                    class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                    
                    Suporte
                </button> </a>
                <br>
          <a href="privacidade.html"> <button
                class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                
                Políticas de privacidade
            </button>
            <br>
            <a href="termos.html"> <button
                class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                
                Termos de Uso
            </button>

        </a>
        <br>
        <br>
            <a href="login.html">
                <button
                    class="w-full px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center">
                    
                    Sair da conta
                </button></a>
            <!-- Alert Messages -->
            <div id="alertMessage" class="mt-4 p-4 rounded-lg hidden max-w-md mx-auto"></div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js';
        import { getAuth, updatePassword, updateEmail, signOut, EmailAuthProvider, reauthenticateWithCredential } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js';
        import { getFirestore, doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBVJIKGivD0wnr4FxAMB-kz8oCNtcLmtYs",
            authDomain: "autos-34b01.firebaseapp.com",
            projectId: "autos-34b01",
            storageBucket: "autos-34b01.appspot.com",
            messagingSenderId: "903227924701",
            appId: "1:903227924701:web:90d4301331b1259765bb34",
            measurementId: "G-PY6L785E86"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();
        const storage = getStorage();

        // Show alert message
        function showAlert(message, isError = false) {
            const alertMessage = document.getElementById('alertMessage');
            alertMessage.textContent = message;
            alertMessage.className = `mt-4 p-4 rounded-lg ${isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            alertMessage.classList.remove('hidden');
            setTimeout(() => {
                alertMessage.classList.add('hidden');
            }, 3000);
        }

        // Elements
        const fullNameInput = document.getElementById('fullName');
        const saveButton = document.getElementById('saveButton');
        const profileImage = document.getElementById('profileImage');
        const displayName = document.getElementById('displayName');
        const userEmail = document.getElementById('userEmail');
        const saveEmailButton = document.getElementById('saveEmailButton');
        const savePasswordButton = document.getElementById('savePasswordButton');

        // Update email
        saveEmailButton.addEventListener('click', async () => {
            const newEmail = document.getElementById('newEmail').value;
            const currentPassword = document.getElementById('currentPasswordEmail').value;

            try {
                const user = auth.currentUser;
                const credential = EmailAuthProvider.credential(user.email, currentPassword);

                // Reauthenticate user
                await reauthenticateWithCredential(user, credential);

                // Update email in Authentication
                await updateEmail(user, newEmail);

                // Update email in Firestore
                await updateDoc(doc(db, 'users', user.uid), {
                    email: newEmail
                });

                document.getElementById('userEmail').textContent = newEmail;
                showAlert('Email atualizado com sucesso!');
                closeEmailModal();
            } catch (error) {
                showAlert(error.message, true);
            }
        });

        // Update password
        savePasswordButton.addEventListener('click', async () => {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                showAlert('As senhas não coincidem', true);
                return;
            }

            try {
                const user = auth.currentUser;
                const credential = EmailAuthProvider.credential(user.email, currentPassword);

                // Reauthenticate user
                await reauthenticateWithCredential(user, credential);

                // Update password
                await updatePassword(user, newPassword);

                showAlert('Senha atualizada com sucesso!');
                closePasswordModal();
            } catch (error) {
                showAlert(error.message, true);
            }
        });

        // Check if user is logged in
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // Load user data from Firestore
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    fullNameInput.value = userData.fullName || '';
                    displayName.textContent = userData.fullName || 'Usuário';
                    userEmail.textContent = user.email;
                    if (userData.photoURL) {
                        profileImage.src = userData.photoURL;
                    }
                }
            } else {
                // Redirect to login page
               // window.location.href = '/login.html';
            }
        });

        // Save changes
        saveButton.addEventListener('click', async () => {
            try {
                const user = auth.currentUser;

                // Update user data in Firestore
                await updateDoc(doc(db, 'users', user.uid), {
                    fullName: fullNameInput.value,
                });

                showAlert('Perfil atualizado com sucesso!');
                displayName.textContent = fullNameInput.value;
            } catch (error) {
                showAlert(error.message, true);
            }
        });

        // Funções de acessibilidade
        document.getElementById('high-contrast').addEventListener('click', function () {
            document.body.classList.toggle('high-contrast');
        });

        document.getElementById('decrease-font').addEventListener('click', function () {
            let currentFontSize = parseFloat(window.getComputedStyle(document.body, null).getPropertyValue('font-size'));
            document.body.style.fontSize = (currentFontSize - 2) + 'px';
        });

        document.getElementById('increase-font').addEventListener('click', function () {
            let currentFontSize = parseFloat(window.getComputedStyle(document.body, null).getPropertyValue('font-size'));
            document.body.style.fontSize = (currentFontSize + 2) + 'px';
        });
    </script>
    <footer class="footer" style="font-size: 18px;">
        <div class="footer-content">
            <div class="footer-section">
                <p class="footer-description">AUTOS</p>
                <p class="footer-description2">Educar e entreter</p>
            </div>
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="index.html">Início</a></li>
                    <li><a href="jogos.html">Jogos</a></li>
                    <li><a href="progresso.html">Progresso</a></li>
                </ul>
            </div>
           
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <p>autos.officialmcm@gmail.com</p>
                <br>
                <a  href="https://www.instagram.com/autos.mcm/">  <i style="font-size: 25px;" class="fab fa-instagram"></i></a> 

            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Todos os direitos reservados.</p>
        </div>
    </footer>
</body>

</html>
